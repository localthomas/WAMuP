let s;var e;(e=s||(s={})).Momentary="momentary",e.ShortTerm="shortTerm";class t extends AudioWorkletProcessor{constructor(){super(),console.debug("EchoProcessor created");const s=.03;this.processor=new r(sampleRate,s,100,(e=>{const t=()=>1;this.onMomentaryLoudnessChange(function(s,e,t){return n(s,e,t,.4)}(e,s,t)),this.onShortTermLoudnessChange(function(s,e,t){return n(s,e,t,3)}(e,s,t))}))}process(s,e,t){return this.processor.appendData(s[0]),!0}onMomentaryLoudnessChange(e){this.postMessage({type:s.Momentary,loudness:e})}onShortTermLoudnessChange(e){this.postMessage({type:s.ShortTerm,loudness:e})}postMessage(s){this.port.postMessage(s)}}registerProcessor("echo-processor",t);class r{rawBuffer=[];powerResults=[];constructor(s,e,t,r){this.frameSamples=s*e,this.numFrames=t,this.onPowerCallback=r}appendData(s){s.forEach(((s,e)=>{this.rawBuffer[e]||(this.rawBuffer[e]=new o(this.frameSamples,(s=>{this.appendPower(e,function(s){let e=0;for(const t of s)e+=t*t;return e/s.length}(s))}))),this.rawBuffer[e].push(s)}))}appendPower(s,e){this.powerResults[s]||(this.powerResults[s]=[]),this.powerResults[s].unshift(e),this.powerResults[s].length>=this.numFrames&&(this.powerResults[s]=this.powerResults[s].slice(0,this.numFrames)),this.onPowerCallback(this.powerResults)}}class o{workingIndex=0;constructor(s,e){this.buffer=new Float32Array(s),this.callback=e}push(s){for(const e of s)this.workingIndex>=this.buffer.length&&(this.callback(this.buffer.slice()),this.workingIndex=0),this.buffer[this.workingIndex]=e,this.workingIndex++}}function n(s,e,t,r){const o=Math.round(r/e);let n=0;for(const[e,r]of s.entries()){const s=t(e);let h=0,a=0;for(const[s,e]of r.entries())s<o&&(h++,a+=e);n+=s*(a/h)}return 10*Math.log10(n)-.691}
//# sourceMappingURL=ebu-r128.worker.a3e242da.js.map
